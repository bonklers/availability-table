<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Viewer v0.08</title>
<style>
body { font-family: Arial; text-align:center; }
table { margin:auto; border-collapse: collapse; }
td {
  width:70px;
  height:70px;
  border:1px solid black;
  font-weight:bold;
}
.desc { display:none; font-size:12px; }
.green { background:#9aff9a; }
.red { background:#ff9a9a; }
.yellow { background:#ffff9a; }
</style>
</head>
<body>

<h2>Viewer</h2>
<button onclick="toggleLegend()">Legend</button>
<table id="grid"></table>

<script src="shared.js"></script>
<script>

function toggleLegend(){
  document.querySelectorAll(".desc")
    .forEach(d=>d.style.display = d.style.display==="block"?"none":"block");
}

/* ======================== */
/* LOAD CURRENT DB STATE */
/* ======================== */
async function loadState(){

  const rows = await api("cell_logs?select=cell_id,color,start_time&order=start_time.desc");

  const cells = document.querySelectorAll("#grid td");
  const found = {};

  cells.forEach(td=>td.className="green");

  rows.forEach(r => {
    const cell = cells[r.cell_id - 1];
    if (!cell || found[r.cell_id]) return;

    cell.className = r.color;
    found[r.cell_id] = true;
  });
}

/* ======================== */
buildGrid("grid", false);
loadState();
setInterval(loadState, 5000);

</script>
</body>
</html>